!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("trafficControl",t):n.trafficControl=t()}(this,function(){"use strict";function n(n,t,e){n.addEventListener(t,e,!1)}function t(n){var t=document.createElement("style"),e=document.head||document.getElementsByTagName("head")[0];t.type="text/css",t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n)),e.appendChild(t)}function e(n){for(var t,e=arguments.length,i=Array(e>1?e-1:0),o=1;e>o;o++)i[o-1]=arguments[o];return(t=n.classList).contains.apply(t,i)}function i(n){for(var t,e=arguments.length,i=Array(e>1?e-1:0),o=1;e>o;o++)i[o-1]=arguments[o];(t=n.classList).add.apply(t,i)}function o(n){for(var t,e=arguments.length,i=Array(e>1?e-1:0),o=1;e>o;o++)i[o-1]=arguments[o];(t=n.classList).remove.apply(t,i)}function r(n){return new Promise(function(t,e){window.fetch(n,{cache:"no-cache"}).then(function(n){return n.ok?n:Promise.reject(n.statusText)}).then(function(n){return n.json()}).then(t)["catch"](e)})}function a(n,t){return new Promise(function(e,i){window.fetch(n,{method:"POST",body:JSON.stringify(t),cache:"no-cache",headers:{"Content-Type":"application/json"}}).then(function(n){return n.ok?n:Promise.reject(n.statusText)}).then(e)["catch"](i)})}function s(n,t,e){n.removeEventListener(t,e)}function c(t,e,i){var o=function r(){i.apply(void 0,arguments),s(t,e,r)};n(t,e,o)}function l(n){for(var t=arguments.length,e=Array(t>1?t-1:0),o=1;t>o;o++)e[o-1]=arguments[o];for(var r=0,a=e.length;a>r;r++)i(n,e[r])}function f(n){for(var t=arguments.length,e=Array(t>1?t-1:0),i=1;t>i;i++)e[i-1]=arguments[i];for(var r=0,a=e.length;a>r;r++)o(n,e[r])}function u(n){var t=window.netlify,e=function(){return new B(n)},i=function(){if(null==t){var n=document.createElement("script");return n.type="text/javascript",n.onload=n.onreadystatechange=e,n.src="https://app.netlify.com/authentication.js",document.body.appendChild(n)}return e()};window.addEventListener?window.addEventListener("load",i,!1):window.attachEvent&&window.attachEvent("onload",i)}!function(n){function t(n){if("string"!=typeof n&&(n=String(n)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(n))throw new TypeError("Invalid character in header field name");return n.toLowerCase()}function e(n){return"string"!=typeof n&&(n=String(n)),n}function i(n){var t={next:function(){var t=n.shift();return{done:void 0===t,value:t}}};return g.iterable&&(t[Symbol.iterator]=function(){return t}),t}function o(n){this.map={},n instanceof o?n.forEach(function(n,t){this.append(t,n)},this):n&&Object.getOwnPropertyNames(n).forEach(function(t){this.append(t,n[t])},this)}function r(n){return n.bodyUsed?Promise.reject(new TypeError("Already read")):void(n.bodyUsed=!0)}function a(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function s(n){var t=new FileReader;return t.readAsArrayBuffer(n),a(t)}function c(n){var t=new FileReader;return t.readAsText(n),a(t)}function l(){return this.bodyUsed=!1,this._initBody=function(n){if(this._bodyInit=n,"string"==typeof n)this._bodyText=n;else if(g.blob&&Blob.prototype.isPrototypeOf(n))this._bodyBlob=n;else if(g.formData&&FormData.prototype.isPrototypeOf(n))this._bodyFormData=n;else if(g.searchParams&&URLSearchParams.prototype.isPrototypeOf(n))this._bodyText=n.toString();else if(n){if(!g.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(n))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof n?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob?(this.blob=function(){var n=r(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(s)},this.text=function(){var n=r(this);if(n)return n;if(this._bodyBlob)return c(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var n=r(this);return n?n:Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(n){var t=n.toUpperCase();return m.indexOf(t)>-1?t:n}function u(n,t){t=t||{};var e=t.body;if(u.prototype.isPrototypeOf(n)){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,t.headers||(this.headers=new o(n.headers)),this.method=n.method,this.mode=n.mode,e||(e=n._bodyInit,n.bodyUsed=!0)}else this.url=n;if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new o(t.headers)),this.method=f(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&e)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(e)}function d(n){var t=new FormData;return n.trim().split("&").forEach(function(n){if(n){var e=n.split("="),i=e.shift().replace(/\+/g," "),o=e.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(o))}}),t}function h(n){var t=new o,e=(n.getAllResponseHeaders()||"").trim().split("\n");return e.forEach(function(n){var e=n.trim().split(":"),i=e.shift().trim(),o=e.join(":").trim();t.append(i,o)}),t}function p(n,t){t||(t={}),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof o?t.headers:new o(t.headers),this.url=t.url||"",this._initBody(n)}if(!n.fetch){var g={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(n){return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};o.prototype.append=function(n,i){n=t(n),i=e(i);var o=this.map[n];o||(o=[],this.map[n]=o),o.push(i)},o.prototype["delete"]=function(n){delete this.map[t(n)]},o.prototype.get=function(n){var e=this.map[t(n)];return e?e[0]:null},o.prototype.getAll=function(n){return this.map[t(n)]||[]},o.prototype.has=function(n){return this.map.hasOwnProperty(t(n))},o.prototype.set=function(n,i){this.map[t(n)]=[e(i)]},o.prototype.forEach=function(n,t){Object.getOwnPropertyNames(this.map).forEach(function(e){this.map[e].forEach(function(i){n.call(t,i,e,this)},this)},this)},o.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),i(n)},o.prototype.values=function(){var n=[];return this.forEach(function(t){n.push(t)}),i(n)},o.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),i(n)},g.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];u.prototype.clone=function(){return new u(this)},l.call(u.prototype),l.call(p.prototype),p.prototype.clone=function(){return new p(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},p.error=function(){var n=new p(null,{status:0,statusText:""});return n.type="error",n};var b=[301,302,303,307,308];p.redirect=function(n,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new p(null,{status:t,headers:{location:n}})},n.Headers=o,n.Request=u,n.Response=p,n.fetch=function(n,t){return new Promise(function(e,i){function o(){return"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0}var r;r=u.prototype.isPrototypeOf(n)&&!t?n:new u(n,t);var a=new XMLHttpRequest;a.onload=function(){var n={status:a.status,statusText:a.statusText,headers:h(a),url:o()},t="response"in a?a.response:a.responseText;e(new p(t,n))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(r.method,r.url,!0),"include"===r.credentials&&(a.withCredentials=!0),"responseType"in a&&g.blob&&(a.responseType="blob"),r.headers.forEach(function(n,t){a.setRequestHeader(t,n)}),a.send("undefined"==typeof r._bodyInit?null:r._bodyInit)})},n.fetch.polyfill=!0}}("undefined"!=typeof self?self:this);var d='<div class="tc-bar">\n  <div class="tc-message">\n    <div class="tc-container">\n      <div class="tc-message--text tc-message--loading">\n        Loading git info\n      </div>\n      <div class="tc-message--text tc-message--synchronized">\n        You are viewing the staging site.\n        Everything is in sync, production is even with staging. ðŸ‘Œ\n      </div>\n      <div class="tc-message--text tc-message--ahead"></div>\n      <div class="tc-message--text tc-message--diverged"></div>\n      <div class="tc-message--text tc-message--instruction"></div>\n      <div class="tc-message--text tc-message--unauthorized">\n        You are viewing the staging site,\n        but you cannot deploy or view changes\n        until you authorize read/write access\n        to your Github repository.\n      </div>\n      <div class="tc-message--text tc-message--conflict">\n        Could not perform merge due to a merge conflict.\n        You\'ll have to do this update manually. ðŸ˜•\n      </div>\n      <div class="tc-message--text tc-message--success">\n        Merge successful! âœ¨ðŸŽŠ\n      </div>\n    </div>\n  </div>\n  <div class="tc-action">\n    <div class="tc-container">\n      <button\n        class="tc-action--button tc-action--deploy"\n        aria-label="Perform a deployment to the production branch."\n      >Deploy</button>\n      <button\n        class="tc-action--button tc-action--authorize"\n        aria-label="Authorize traffic-control to access your Github account."\n      >Authorize</button>\n      <button\n        class="tc-action--button tc-action--info"\n        aria-label="Find out more information."\n      >How?</button>\n      <button\n        class="tc-action--button tc-action--ok"\n        aria-label="Close git instructions"\n      >Ok</button>\n      <button\n        class="tc-action--button tc-action--conflict"\n        aria-label="Close merge conflict message"\n      >Ok</button>\n    </div>\n  </div>\n  <div class="tc-close">\n    <div class="tc-container">\n      <button\n        class="tc-close--button"\n        aria-label="Close traffic-control deployment user interface."\n      >&times;</button>\n    </div>\n  </div>\n</div>\n',h="/*\n  Note: there is a lot of repetition going on in this CSS.\n  This is intentional, in order to keep specificity low\n  enough that custom styles are easier to implement.\n */\n\ntraffic-control {\n  box-sizing: border-box;\n}\n\ntraffic-control *,\ntraffic-control *:before,\ntraffic-control *:after {\n  box-sizing: inherit;\n}\n\ntraffic-control {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  z-index: 10000;\n}\n\ntraffic-control .tc-container {\n  position: relative;\n}\n\ntraffic-control .tc-bar {\n  display: none;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  table-layout: fixed;\n  font-family: sans-serif;\n  background: #eee;\n  color: #aaa;\n  transition: all .2s ease;\n  min-height: 60px;\n}\n\ntraffic-control.is-loading .tc-bar {\n  background: #eee;\n  color: #aaa;\n}\n\ntraffic-control.is-instruction .tc-bar {\n  background: #333;\n  color: #fff;\n}\n\ntraffic-control.is-unauthorized .tc-bar {\n  background: #E02D2D;\n  color: #fff;\n}\n\ntraffic-control.is-conflict .tc-bar {\n  background: #E02D2D;\n  color: #fff;\n}\n\ntraffic-control.is-diverged .tc-bar {\n  background: #FFC72F;\n  color: #784E4E;\n}\n\ntraffic-control.is-ahead .tc-bar {\n  background: #B8D5E9;\n  color: #505050;\n}\n\ntraffic-control.is-synchronized .tc-bar {\n  background: #BAE9B8;\n  color: #505050;\n}\n\ntraffic-control.is-success .tc-bar {\n  background: #BAE9B8;\n  color: #505050;\n}\n\ntraffic-control .tc-bar.is-entering {\n  animation: slideInUp .6s ease both;\n  animation-delay: .6s;\n}\n\ntraffic-control .tc-bar.is-leaving {\n  animation: slideOutDown .6s ease both;\n}\n\ntraffic-control .tc-message {\n  display: table-cell;\n  vertical-align: middle;\n  height: 100%;\n}\n\ntraffic-control .tc-action {\n  display: table-cell;\n  vertical-align: middle;\n  height: 100%;\n  width: 100px;\n}\n\ntraffic-control .tc-action--button {\n  margin: 0 auto;\n  width: 80%;\n  padding: 8px 0;\n  text-transform: uppercase;\n  color: #eee;\n  background: transparent;\n  border: 1px solid;\n  border-radius: 4px;\n  outline: none;\n  cursor: pointer;\n  overflow: hidden;\n  transition: .5s ease;\n}\n\ntraffic-control .tc-action--button:hover {\n  background: rgba(255, 255, 255, 0.2);\n}\n\ntraffic-control .tc-action--button:active {\n  transform: scale(0.2);\n}\n\ntraffic-control.is-diverged .tc-action--button {\n  color: #BB8800;\n}\n\ntraffic-control.is-ahead .tc-action--button {\n  color: #678BA3;\n}\n\ntraffic-control .tc-close {\n  display: table-cell;\n  vertical-align: middle;\n  height: 100%;\n  width: 60px;\n  border-left: 1px solid #eee;\n  transition: all .25s ease;\n}\n\ntraffic-control .tc-close:hover {\n  background: rgba(0, 0, 0, 0.1);\n}\n\ntraffic-control.is-loading .tc-close {\n  border-color: #ccc;\n}\n\ntraffic-control.is-diverged .tc-close {\n  border-color: #FFDA77;\n}\n\ntraffic-control.is-instruction .tc-close {\n  border-color: #888;\n}\n\ntraffic-control.is-unauthorized .tc-close {\n  border-color: #ED5252;\n}\n\ntraffic-control.is-conflict .tc-close {\n  border-color: #ED5252;\n}\n\ntraffic-control.is-ahead .tc-close {\n  border-color: #C4DEF0;\n}\n\ntraffic-control.is-synchronized .tc-close {\n  border-color: #C6F5C4;\n}\n\ntraffic-control.is-success .tc-close {\n  border-color: #C6F5C4;\n}\n\ntraffic-control .tc-message--text {\n  font-size: 14px;\n  position: relative;\n  padding: 16px;\n  backface-visibility: hidden;\n}\n\ntraffic-control .tc-message--text a {\n  font-weight: bold;\n}\n\ntraffic-control.is-diverged .tc-message--text a {\n  color: #BB8800;\n}\n\ntraffic-control.is-ahead .tc-message--text a {\n  color: #678BA3;\n}\n\ntraffic-control .tc-message--loading {\n  display: none;\n}\n\ntraffic-control .tc-message--loading:after {\n  margin-left: -2px;\n  content: ' ';\n  animation: ellipsis 1s linear infinite;\n}\n\ntraffic-control .tc-message--loading.is-entering {\n  animation: slideInUp .6s cubic-bezier(0.19, 1, 0.22, 1) both;\n}\n\ntraffic-control .tc-message--loading.is-leaving {\n  animation: slideOutUp .6s cubic-bezier(0.95, 0.05, 0.795, 0.035) both;\n}\n\ntraffic-control .tc-message--instruction {\n  display: none;\n  font-family: monospace;\n}\n\ntraffic-control .tc-message--instruction.is-entering {\n  animation: slideInUp .6s cubic-bezier(0.19, 1, 0.22, 1) both;\n}\n\ntraffic-control .tc-message--instruction.is-leaving {\n  animation: slideOutUp .6s cubic-bezier(0.95, 0.05, 0.795, 0.035) both;\n}\n\ntraffic-control .tc-message--synchronized {\n  display: none;\n}\n\ntraffic-control .tc-message--synchronized.is-entering {\n  animation: slideInUp .6s cubic-bezier(0.19, 1, 0.22, 1) both;\n}\n\ntraffic-control .tc-message--synchronized.is-leaving {\n  animation: slideOutUp .6s cubic-bezier(0.95, 0.05, 0.795, 0.035) both;\n}\n\ntraffic-control .tc-message--diverged {\n  display: none;\n}\n\ntraffic-control .tc-message--diverged.is-entering {\n  animation: slideInUp .6s cubic-bezier(0.19, 1, 0.22, 1) both;\n}\n\ntraffic-control .tc-message--diverged.is-leaving {\n  animation: slideOutUp .6s cubic-bezier(0.95, 0.05, 0.795, 0.035) both;\n}\n\ntraffic-control .tc-message--unauthorized {\n  display: none;\n}\n\ntraffic-control .tc-message--unauthorized.is-entering {\n  animation: slideInUp .6s cubic-bezier(0.19, 1, 0.22, 1) both;\n}\n\ntraffic-control .tc-message--unauthorized.is-leaving {\n  animation: slideOutUp .6s cubic-bezier(0.95, 0.05, 0.795, 0.035) both;\n}\n\ntraffic-control .tc-message--conflict {\n  display: none;\n}\n\ntraffic-control .tc-message--conflict.is-entering {\n  animation: slideInUp .6s cubic-bezier(0.19, 1, 0.22, 1) both;\n}\n\ntraffic-control .tc-message--conflict.is-leaving {\n  animation: slideOutUp .6s cubic-bezier(0.95, 0.05, 0.795, 0.035) both;\n}\n\ntraffic-control .tc-message--success {\n  display: none;\n}\n\ntraffic-control .tc-message--success.is-entering {\n  animation: slideInUp .6s cubic-bezier(0.19, 1, 0.22, 1) both;\n}\n\ntraffic-control .tc-message--success.is-leaving {\n  animation: slideOutUp .6s cubic-bezier(0.95, 0.05, 0.795, 0.035) both;\n}\n\ntraffic-control .tc-message--ahead {\n  display: none;\n}\n\ntraffic-control .tc-message--ahead.is-entering {\n  animation: slideInUp .6s cubic-bezier(0.19, 1, 0.22, 1) both;\n}\n\ntraffic-control .tc-message--ahead.is-leaving {\n  animation: slideOutUp .6s cubic-bezier(0.95, 0.05, 0.795, 0.035) both;\n}\n\ntraffic-control .tc-action--deploy {\n  display: none;\n}\n\ntraffic-control .tc-action--deploy.is-entering {\n  animation: slideInUp .6s ease both;\n}\n\ntraffic-control .tc-action--deploy.is-leaving {\n  animation: slideOutUp .6s ease both;\n}\n\ntraffic-control .tc-action--ok {\n  display: none;\n}\n\ntraffic-control .tc-action--ok.is-entering {\n  animation: slideInUp .6s ease both;\n}\n\ntraffic-control .tc-action--ok.is-leaving {\n  animation: slideOutUp .6s ease both;\n}\n\ntraffic-control .tc-action--info {\n  display: none;\n}\n\ntraffic-control .tc-action--info.is-entering {\n  animation: slideInUp .6s ease both;\n}\n\ntraffic-control .tc-action--info.is-leaving {\n  animation: slideOutUp .6s ease both;\n}\n\ntraffic-control .tc-action--authorize {\n  display: none;\n}\n\ntraffic-control .tc-action--authorize.is-entering {\n  animation: slideInUp .6s ease both;\n}\n\ntraffic-control .tc-action--authorize.is-leaving {\n  animation: slideOutUp .6s ease both;\n}\n\ntraffic-control .tc-action--conflict {\n  display: none;\n}\n\ntraffic-control .tc-action--conflict.is-entering {\n  animation: slideInUp .6s ease both;\n}\n\ntraffic-control .tc-action--conflict.is-leaving {\n  animation: slideOutUp .6s ease both;\n}\n\ntraffic-control .tc-action--success {\n  display: none;\n}\n\ntraffic-control .tc-action--success.is-entering {\n  animation: slideInUp .6s ease both;\n}\n\ntraffic-control .tc-action--success.is-leaving {\n  animation: slideOutUp .6s ease both;\n}\n\ntraffic-control .tc-close--button {\n  display: none;\n  margin: 0 auto;\n  padding: 16px;\n  width: 100%;\n  border: none;\n  outline: none;\n  background: none;\n  color: #eee;\n  font-size: 24px;\n  font-family: Arial, sans-serif;\n  cursor: pointer;\n  height: 100%;\n  position: relative;\n  transition: all .2s ease;\n  text-align: center;\n}\n\ntraffic-control.is-loading .tc-close--button {\n  color: #ccc;\n}\n\ntraffic-control.is-diverged .tc-close--button {\n  color: #FFDA77;\n}\n\ntraffic-control.is-instruction .tc-close--button {\n  color: #888;\n}\n\ntraffic-control.is-unauthorized .tc-close--button {\n  color: #ED5252;\n}\n\ntraffic-control.is-conflict .tc-close--button {\n  color: #ED5252;\n}\n\ntraffic-control.is-ahead .tc-close--button {\n  color: #C4DEF0;\n}\n\ntraffic-control.is-synchronized .tc-close--button {\n  color: #C6F5C4;\n}\n\ntraffic-control.is-success .tc-close--button {\n  color: #C6F5C4;\n}\n\ntraffic-control .tc-close--button.is-entering {\n  animation: slideInUp .6s cubic-bezier(0.19, 1, 0.22, 1) both;\n}\n\ntraffic-control .tc-close--button.is-leaving {\n  animation: slideOutUp .6s cubic-bezier(0.95, 0.05, 0.795, 0.035) both;\n}\n\ntraffic-control .tc-bar.is-active {\n  display: table;\n}\n\ntraffic-control .tc-message--loading.is-active {\n  display: block;\n}\n\ntraffic-control .tc-message--synchronized.is-active {\n  display: block;\n}\n\ntraffic-control .tc-message--diverged.is-active {\n  display: block;\n}\n\ntraffic-control .tc-message--unauthorized.is-active {\n  display: block;\n}\n\ntraffic-control .tc-message--conflict.is-active {\n  display: block;\n}\n\ntraffic-control .tc-message--success.is-active {\n  display: block;\n}\n\ntraffic-control .tc-message--instruction.is-active {\n  display: block;\n}\n\ntraffic-control .tc-message--ahead.is-active {\n  display: block;\n}\n\ntraffic-control .tc-action--deploy.is-active {\n  display: block;\n}\n\ntraffic-control .tc-action--ok.is-active {\n  display: block;\n}\n\ntraffic-control .tc-action--conflict.is-active {\n  display: block;\n}\n\ntraffic-control .tc-action--success.is-active {\n  display: block;\n}\n\ntraffic-control .tc-action--info.is-active {\n  display: block;\n}\n\ntraffic-control .tc-action--authorize.is-active {\n  display: block;\n}\n\ntraffic-control .tc-close--button.is-active {\n  display: block;\n}\n\n@keyframes slideInUp {\n  0% {\n    transform: translateY(100%);\n    opacity: 0;\n  }\n  100% {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n\n@keyframes slideOutUp {\n  0% {\n    transform: translateY(0);\n    opacity: 1;\n  }\n  100% {\n    transform: translateY(-100%);\n    opacity: 0;\n  }\n}\n\n@keyframes slideOutDown {\n  0% {\n    transform: translateY(0);\n    opacity: 1;\n  }\n  100% {\n    transform: translateY(100%);\n    opacity: 0;\n  }\n}\n\n@keyframes ellipsis {\n  0% {\n    content: ' '\n  }\n  33% {\n    content: '.'\n  }\n  66% {\n    content: '..'\n  }\n  99% {\n    content: '...'\n  }\n}\n",p=function(){var n=document.createElement("fakeelement"),t={animation:"animationend",OAnimation:"oanimationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd",MSAnimation:"MSAnimationEnd"};for(var e in t)if(null!=!n.style[e])return t[e]}(),g=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},m=function(){function n(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),b=function(n){if(Array.isArray(n)){for(var t=0,e=Array(n.length);t<n.length;t++)e[t]=n[t];return e}return Array.from(n)},y=function(){function n(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];g(this,n),this.opts=Object.assign({enterClass:"is-entering",activeClass:"is-active",leaveClass:"is-leaving"},t)}return m(n,[{key:"animateIn",value:function(){for(var n=this,t=arguments.length,e=Array(t),i=0;t>i;i++)e[i]=arguments[i];return Promise.all(e.map(function(t){return new Promise(function(e){c(t,p,e),l(t,n.opts.activeClass,n.opts.enterClass)})}))}},{key:"animateOut",value:function(){for(var n=this,t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];return Promise.all(e.map(function(t){return new Promise(function(e){c(t,p,function(){f(t,n.opts.leaveClass,n.opts.activeClass),e()}),o(t,n.opts.enterClass),i(t,n.opts.leaveClass)})}))}}]),n}(),v=new y,w=window.netlify,k=window.localStorage,B=function(){function s(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];g(this,s),n=Object.assign({},this.getDefaultOpts(),n),n.repoURL=n.ghAPI+"/repos/"+n.repo,n.compareURL=n.repoURL+"/compare",n.compareBranchesURL=n.compareURL+"/"+n.productionBranch+"..."+n.stagingBranch,this.opts=this.validateOpts(n),this.init()}return m(s,[{key:"getDefaultOpts",value:function(){return{stagingBranch:"develop",productionBranch:"master",ghAPI:"https://api.github.com",containerEl:document.body}}},{key:"validateOpts",value:function(n){if(null==n.repo)throw new Error("You need to specify a repository.");return n}},{key:"init",value:function(){var n=this;t(h),this.initializeElementWithMarkup(),this.instantiateElementWithDefaultState().then(function(){return n.computeAndAnimateState()})["catch"](function(n){return console.error(n)})}},{key:"initializeElementWithMarkup",value:function(){this.el=document.createElement("traffic-control"),this.el.id="traffic-control",this.el.innerHTML=d,this.addDomRefs(),this.els.instructionMsg.innerHTML="\n      git checkout "+this.opts.stagingBranch+" &&\n      git pull -r origin "+this.opts.productionBranch+" &&\n      git push origin "+this.opts.stagingBranch+" --force\n    ",this.addEventHooks(),this.addStates()}},{key:"addDomRefs",value:function(){this.els=this.getDOMReferences({bar:"tc-bar",loadingMsg:"tc-message--loading",syncedMsg:"tc-message--synchronized",aheadMsg:"tc-message--ahead",divergedMsg:"tc-message--diverged",unauthedMsg:"tc-message--unauthorized",instructionMsg:"tc-message--instruction",conflictMsg:"tc-message--conflict",successMsg:"tc-message--success",deployBtn:"tc-action--deploy",authBtn:"tc-action--authorize",infoBtn:"tc-action--info",okBtn:"tc-action--ok",conflictBtn:"tc-action--conflict",closeBtn:"tc-close--button"})}},{key:"addState",value:function(n,t){var e=this,i=void 0;this.states=this.states||{},i=Array.isArray(t)?{ui:t}:t,i.ui=i.ui.map(function(n){return e.els[n]}),this.states[n]=i}},{key:"addStates",value:function(){this.addState("mounted",{ui:["bar"],persist:!0}),this.addState("loading",["loadingMsg","closeBtn"]),this.addState("unauthorized",["unauthedMsg","authBtn","closeBtn"]),this.addState("ahead",["aheadMsg","deployBtn","closeBtn"]),this.addState("diverged",["divergedMsg","infoBtn","closeBtn"]),this.addState("synchronized",["syncedMsg","closeBtn"]),this.addState("instruction",["instructionMsg","okBtn","closeBtn"]),this.addState("conflict",["conflictMsg","conflictBtn","closeBtn"]),this.addState("success",["successMsg","closeBtn"])}},{key:"addEventHooks",value:function(){var t=this;n(this.els.infoBtn,"click",function(){return t.renderState("instruction")}),n(this.els.okBtn,"click",function(){return t.renderState("diverged")}),n(this.els.closeBtn,"click",function(){return t.unRenderState("mounted")}),n(this.els.authBtn,"click",function(){return t.authenticateGithub().then(function(n){var e=n.token;return k.gh_token=e,t.computeAndAnimateState()})["catch"](function(n){return console.error(n)})}),n(this.els.conflictBtn,"click",function(){return t.computeAndAnimateState()}),n(this.els.deployBtn,"click",function(){t.renderState("loading").then(function(){return t.merge()}).then(function(n){return t.renderMergeStatus(n)})["catch"](function(n){return console.error(n)})})}},{key:"renderMergeStatus",value:function(n){var t=this,e=n.status;return 201===e?this.renderState("success").then(function(){return t.computeAndAnimateState()}):409===e?this.renderState("conflict"):void 0}},{key:"merge",value:function(){return a(this.opts.repoURL+"/merges?access_token="+k.gh_token,{base:this.opts.productionBranch,head:this.opts.stagingBranch,commit_message:":vertical_traffic_light: Production deploy triggered from traffic-control"})}},{key:"getDOMReferences",value:function(n){var t={};for(var e in n)n.hasOwnProperty(e)&&(t[e]=this.el.getElementsByClassName(n[e])[0]);return t}},{key:"instantiateElementWithDefaultState",value:function(){return this.opts.containerEl.appendChild(this.el),this.renderState("mounted")}},{key:"computeAndAnimateState",value:function(){var n=this;return this.renderState("loading").then(function(){return k.gh_token?n.getBranchComparison().then(function(t){return n.renderDeploymentState(t)}):n.renderState("unauthorized")})["catch"](function(n){return console.error(n)})}},{key:"renderDeploymentState",value:function(n){var t=n.status,e=n.ahead_by,i=n.behind_by,o=n.permalink_url;switch(t){case"ahead":case"diverged":return this.els[t+"Msg"].innerHTML="ahead"===t?this.getAheadMessage(e,o):this.getDivergedMessage(i,o),this.renderState(t);default:return this.renderState("synchronized")}}},{key:"getBranchComparison",value:function(){var n=(new Date).getTime();return r(this.opts.compareBranchesURL+"?access_token="+k.gh_token+"&cache_buster="+n)}},{key:"getCurrentStates",value:function(n){var t=this,e=n.filter;return Object.keys(this.states).filter(function(n){return n!==e&&!t.states[n].persist})}},{key:"renderState",value:function(n){var t=this;return Promise.all(this.getCurrentStates({filter:n}).map(function(n){return new Promise(function(i){return e(t.el,"is-"+n)?t.unRenderState(n).then(i):i()})})).then(function(){return i(t.el,"is-"+n),v.animateIn.apply(v,b(t.states[n].ui))})}},{key:"unRenderState",value:function(n){var t=this;return v.animateOut.apply(v,b(this.states[n].ui)).then(function(){return o(t.el,"is-"+n)})}},{key:"getAheadMessage",value:function(n,t){return"\n      You are viewing the staging site.\n      There "+(n>1?"have":"has")+' been\n      <a href="'+t+'" target="_blank">'+n+"</a>\n      "+(n>1?"changes":"change")+" since the last production build. ðŸš¢\n    "}},{key:"getDivergedMessage",value:function(n,t){return'\n      You are viewing the staging site.\n      Staging has diverged behind production by\n      <a href="'+t+'" target="_blank">'+n+"</a>\n      "+(n>1?"commits":"commit")+". Please rebase.\n    "}},{key:"authenticateGithub",value:function(){return new Promise(function(n,t){w.authenticate({provider:"github",scope:"repo"},function(e,i){return e?t(e):n(i)})})}}]),s}();return u});