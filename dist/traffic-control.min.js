!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("trafficControl",t):e.trafficControl=t()}(this,function(){"use strict";function e(e){function t(){function t(){if(i.gh_token)n.getJSON(e.GH_API+"/repos/"+e.repo+"/compare/"+e.productionBranch+"..."+e.stagingBranch+"develop?access_token="+i.gh_token,function(o){s.empty();var r=n("<button>Deploy</button>");if("ahead"===o.status){var d=o.ahead_by>1?"have":"has",l=o.ahead_by>1?"changes":"change";c.html("You are viewing the staging site. There "+d+' been <a href="'+o.permalink_url+'" target="_blank">'+o.ahead_by+"</a> "+l+" since the last production build. ðŸš¢"),s.append(c),s.css({backgroundColor:"#B8D5E9",color:"#222"}),s.append(r),a.prepend(s),r.on("click",function(){n.post(e.GH_API+"/repos/"+e.repo+"/merges?access_token="+i.gh_token,JSON.stringify({base:"master",head:"develop",commit_message:":vertical_traffic_light: Production deploy triggered from traffic-control"}),function(){t()})})}else if("diverged"===o.status){var p=o.behind_by>1?"commits":"commit";c.html('You are viewing the staging site. Staging has diverged behind production by <a href="'+o.permalink_url+'" target="_blank">'+o.behind_by+"</a> "+p+". Please rebase."),s.append(c),s.css({backgroundColor:"orange",color:"#222"}),a.prepend(s)}else c.text("You are viewing the staging site. Everything is in sync, production is even with staging. ðŸ‘Œ"),s.append(c),s.css({backgroundColor:"#BAE9B8",color:"#222"}),a.prepend(s)});else{s.empty();var o=n("<button>Authorize</button>");c.text("You are viewing the staging site, but you cannot deploy or view changes until you authorize read/write access to your Github repository."),s.append(c),s.css({backgroundColor:"#E02D2D",color:"white"}),s.append(o),a.prepend(s),o.on("click",function(){r.authenticate({provider:"github",scope:"repo"},function(e,n){e&&console.log("Error authenticating: %s",e.message),i.gh_token=n.token,t()})})}}var n=window.$,i=window.localStorage,r=window.netlify,a=n(o),s=n("#staging-bar"),c=n("<div />");t()}function n(){var e=window.jQuery,n="//";if(window.location.href.includes("file://")&&(n="https://"),"undefined"==typeof e||null===e){var o=document.createElement("script");return o.type="text/javascript",o.onload=o.onreadystatechange=t,o.src=n+"code.jquery.com/jquery-2.2.4.min.js",document.body.appendChild(o)}return t()}if(e=e||{},e.GH_API=e.GH_API||"https://api.github.com",e.stagingBranch=e.stagingBranch||"develop",e.productionBranch=e.productionBranch||"master",null==e.repo)throw new Error("You need to specify a repository.");var o=document.getElementsByTagName("body")[0],i=document.createElement("div");i.id="staging-bar",i.style.backgroundColor="#eee",i.style.color="#222",i.style.fontFamily="sans-serif",i.style.padding="16px 8px",i.style.position="fixed",i.style.top="0",i.style.width="100%",i.innerText="Loading...",o.insertBefore(i,o.firstChild),window.addEventListener?window.addEventListener("load",n,!1):window.attachEvent&&window.attachEvent("onload",n)}return e});